import{u as k,b as C,l as P,k as v,m as S,n as T,c as I,o as l,d as n,e,h as V,i as $,f as K,v as N,j as y,p as d,t as a,q as p,F as O,s as Q,g as q,w as B}from"./index-a860f218.js";import{u as D}from"./trades-d5360864.js";import{g as M,s as U,a as z}from"./stockApi-a4111977.js";const E={class:"space-y-6"},H={class:"flex justify-between items-center"},W={class:"card"},G={class:"flex gap-2"},J={key:0,class:"text-center py-8"},R={key:1,class:"card text-center"},X={class:"text-danger"},Y={key:2,class:"card text-center"},Z={key:3,class:"space-y-6"},tt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},et={class:"card"},st={class:"text-2xl font-bold text-gray-900 mt-2"},ot={class:"card"},at={class:"text-2xl font-bold text-gray-900 mt-2"},rt={class:"card"},lt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},nt=["onClick"],it={class:"flex justify-between items-start mb-4"},dt={class:"text-lg font-semibold text-gray-900"},ct={class:"text-sm text-gray-600"},ut={class:"text-right"},mt={class:"text-lg font-semibold"},xt={key:0,class:"text-xs text-gray-500"},pt=["onClick"],ft={class:"space-y-2"},gt={class:"flex justify-between text-sm"},vt={class:"font-medium"},yt={class:"flex justify-between text-sm"},ht={class:"font-medium"},_t={class:"flex justify-between text-sm"},bt={class:"mt-4 pt-4 border-t border-gray-200"},$t={__name:"Home",setup(wt){const r=D(),A=k(),m=C(""),h=C({}),F=async o=>{if(!o||!window.confirm(`确定删除 ${o} 的所有交易记录吗？该操作不可恢复。`))return;const t=await r.deleteStock(o);t.success||alert(t.error||"删除失败")};P(()=>{m.value=M()||"",A.isAuthenticated&&r.fetchTrades()});const j=()=>{U(m.value),f()},f=async()=>{if(r.hasTrades)for(const o of Object.keys(r.trades))try{const t=await z(o);t.success&&(h.value[o]=t)}catch(t){console.error(`Failed to fetch quote for ${o}:`,t)}},_=v(()=>Object.entries(r.trades).map(([o,t])=>{const i=h.value[o],s=i&&!i.mock&&typeof i.price=="number"?i.price:null,c=t.totalCost,u=s!=null?s*t.totalShares:null,x=s!=null?u-c:null,L=s!=null&&c>0?x/c*100:null;return{...t,code:o,currentPrice:s,marketValue:u,totalProfitLoss:x,profitLossPercent:L,quote:i}})),b=v(()=>Object.values(r.trades).reduce((o,t)=>o+t.totalCost,0)),w=v(()=>_.value.reduce((o,t)=>o+(t.marketValue!=null?t.marketValue:0),0));S(()=>r.hasTrades,o=>{o&&f()});let g;return P(()=>{g=setInterval(f,3e4)}),T(()=>{g&&clearInterval(g)}),(o,t)=>{const i=I("router-link");return l(),n("div",E,[e("div",H,[t[3]||(t[3]=e("h1",{class:"text-2xl font-bold text-gray-900"},"我的持仓",-1)),V(i,{to:"/add-trade",class:"btn-primary"},{default:$(()=>[...t[2]||(t[2]=[y(" 添加交易 ",-1)])]),_:1})]),e("div",W,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium mb-4"},"Alpha Vantage API 密钥",-1)),e("div",G,[K(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),type:"password",placeholder:"输入您的 API 密钥（可选）",class:"form-input flex-1"},null,512),[[N,m.value]]),e("button",{onClick:j,class:"btn-primary"}," 保存 ")]),t[5]||(t[5]=e("p",{class:"text-sm text-gray-600 mt-2"},[y(" 如果没有密钥，系统会使用模拟数据。获取免费密钥： "),e("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",class:"text-primary-600 hover:text-primary-500"}," Alpha Vantage ")],-1))]),d(r).loading?(l(),n("div",J,[...t[6]||(t[6]=[e("div",{class:"text-gray-600"},"加载中...",-1)])])):d(r).error?(l(),n("div",R,[e("div",X,a(d(r).error),1),e("button",{onClick:t[1]||(t[1]=(...s)=>d(r).fetchTrades&&d(r).fetchTrades(...s)),class:"btn-primary mt-4"}," 重试 ")])):d(r).hasTrades?(l(),n("div",Z,[e("div",tt,[e("div",et,[t[9]||(t[9]=e("h3",{class:"text-sm font-medium text-gray-500"},"总持仓股票数",-1)),e("p",st,a(Object.keys(d(r).trades).length),1)]),e("div",ot,[t[10]||(t[10]=e("h3",{class:"text-sm font-medium text-gray-500"},"总投入成本",-1)),e("p",at,"$"+a(b.value.toFixed(2)),1)]),e("div",rt,[t[11]||(t[11]=e("h3",{class:"text-sm font-medium text-gray-500"},"当前总市值",-1)),e("p",{class:p(["text-2xl font-bold mt-2",w.value>=b.value?"text-success":"text-danger"])}," $"+a(w.value.toFixed(2)),3)])]),e("div",lt,[(l(!0),n(O,null,Q(_.value,s=>{var c,u;return l(),n("div",{key:s.code,class:"card hover:shadow-lg transition-shadow cursor-pointer",onClick:x=>o.$router.push(`/detail/${s.code}`)},[e("div",it,[e("div",null,[e("h3",dt,a(s.code),1),e("p",ct,a(s.totalShares)+" 股",1)]),e("div",ut,[e("p",mt,"$"+a(((c=s.currentPrice)==null?void 0:c.toFixed(2))||"--"),1),(u=s.quote)!=null&&u.mock?(l(),n("p",xt,"(模拟)")):q("",!0),s.quote?(l(),n("p",{key:1,class:p(["text-sm",s.quote.change>=0?"text-success":"text-danger"])},a(s.quote.change>=0?"+":"")+a(s.quote.change.toFixed(2))+" ("+a(s.quote.changePercent)+") ",3)):q("",!0),e("button",{onClick:B(x=>F(s.code),["stop"]),class:"mt-2 text-xs px-2 py-1 rounded bg-red-50 text-red-600 hover:bg-red-100",title:"删除该股票"},"删除",8,pt)])]),e("div",ft,[e("div",gt,[t[12]||(t[12]=e("span",{class:"text-gray-600"},"平均成本:",-1)),e("span",vt,"$"+a(s.avgCost.toFixed(2)),1)]),e("div",yt,[t[13]||(t[13]=e("span",{class:"text-gray-600"},"总市值:",-1)),e("span",ht,"$"+a(s.marketValue!=null?s.marketValue.toFixed(2):"--"),1)]),e("div",_t,[t[14]||(t[14]=e("span",{class:"text-gray-600"},"盈亏:",-1)),e("span",{class:p(["font-medium",(s.totalProfitLoss??0)>=0?"text-success":"text-danger"])},a((s.totalProfitLoss??0)>=0?"+":"")+a(s.profitLossPercent!=null?s.profitLossPercent.toFixed(2):"--")+"% ",3)])]),e("div",bt,[e("div",{class:p(["text-sm font-medium",(s.totalProfitLoss??0)>=0?"text-success":"text-danger"])}," 总盈亏: $"+a(s.totalProfitLoss!=null?s.totalProfitLoss.toFixed(2):"--"),3)])],8,nt)}),128))])])):(l(),n("div",Y,[t[8]||(t[8]=e("div",{class:"text-gray-600 mb-4"},"还没有任何交易记录",-1)),V(i,{to:"/add-trade",class:"btn-primary"},{default:$(()=>[...t[7]||(t[7]=[y(" 添加第一笔交易 ",-1)])]),_:1})]))])}}};export{$t as default};
