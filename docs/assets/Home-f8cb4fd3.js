import{u as k,b as C,l as V,k as g,m as L,n as S,c as T,o as l,d as i,e,h as P,i as $,f as I,v as K,j as v,p as d,t as a,q as x,F as N,s as O,g as Q,w as B}from"./index-7cc314ad.js";import{u as D}from"./trades-0508ccf4.js";import{g as M,s as U,a as z}from"./stockApi-fe24a09d.js";const E={class:"space-y-6"},H={class:"flex justify-between items-center"},W={class:"card"},G={class:"flex gap-2"},J={key:0,class:"text-center py-8"},R={key:1,class:"card text-center"},X={class:"text-danger"},Y={key:2,class:"card text-center"},Z={key:3,class:"space-y-6"},tt={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},et={class:"card"},st={class:"text-2xl font-bold text-gray-900 mt-2"},ot={class:"card"},at={class:"text-2xl font-bold text-gray-900 mt-2"},rt={class:"card"},nt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},lt=["onClick"],it={class:"flex justify-between items-start mb-4"},dt={class:"text-lg font-semibold text-gray-900"},ct={class:"text-sm text-gray-600"},ut={class:"text-right"},mt={class:"text-lg font-semibold"},xt=["onClick"],pt={class:"space-y-2"},ft={class:"flex justify-between text-sm"},gt={class:"font-medium"},vt={class:"flex justify-between text-sm"},yt={class:"font-medium"},ht={class:"flex justify-between text-sm"},_t={class:"mt-4 pt-4 border-t border-gray-200"},Pt={__name:"Home",setup(bt){const r=D(),A=k(),u=C(""),y=C({}),F=async o=>{if(!o||!window.confirm(`确定删除 ${o} 的所有交易记录吗？该操作不可恢复。`))return;const t=await r.deleteStock(o);t.success||alert(t.error||"删除失败")};V(()=>{u.value=M()||"",A.isAuthenticated&&r.fetchTrades()});const j=()=>{U(u.value),p()},p=async()=>{if(r.hasTrades)for(const o of Object.keys(r.trades))try{const t=await z(o);t.success&&(y.value[o]=t)}catch(t){console.error(`Failed to fetch quote for ${o}:`,t)}},h=g(()=>Object.entries(r.trades).map(([o,t])=>{const n=y.value[o],s=n&&!n.mock&&typeof n.price=="number"?n.price:null,c=t.totalCost,m=s!=null?s*t.totalShares:null,w=s!=null?m-c:null,q=s!=null&&c>0?w/c*100:null;return{...t,code:o,currentPrice:s,marketValue:m,totalProfitLoss:w,profitLossPercent:q,quote:n}})),_=g(()=>Object.values(r.trades).reduce((o,t)=>o+t.totalCost,0)),b=g(()=>h.value.reduce((o,t)=>o+(t.marketValue!=null?t.marketValue:0),0));L(()=>r.hasTrades,o=>{o&&p()});let f;return V(()=>{f=setInterval(p,3e4)}),S(()=>{f&&clearInterval(f)}),(o,t)=>{const n=T("router-link");return l(),i("div",E,[e("div",H,[t[3]||(t[3]=e("h1",{class:"text-2xl font-bold text-gray-900"},"我的持仓",-1)),P(n,{to:"/add-trade",class:"btn-primary"},{default:$(()=>[...t[2]||(t[2]=[v(" 添加交易 ",-1)])]),_:1})]),e("div",W,[t[4]||(t[4]=e("h3",{class:"text-lg font-medium mb-4"},"Alpha Vantage API 密钥",-1)),e("div",G,[I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),type:"password",placeholder:"输入您的 API 密钥（可选）",class:"form-input flex-1"},null,512),[[K,u.value]]),e("button",{onClick:j,class:"btn-primary"}," 保存 ")]),t[5]||(t[5]=e("p",{class:"text-sm text-gray-600 mt-2"},[v(" 如果没有密钥，系统会使用模拟数据。获取免费密钥： "),e("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",class:"text-primary-600 hover:text-primary-500"}," Alpha Vantage ")],-1))]),d(r).loading?(l(),i("div",J,[...t[6]||(t[6]=[e("div",{class:"text-gray-600"},"加载中...",-1)])])):d(r).error?(l(),i("div",R,[e("div",X,a(d(r).error),1),e("button",{onClick:t[1]||(t[1]=(...s)=>d(r).fetchTrades&&d(r).fetchTrades(...s)),class:"btn-primary mt-4"}," 重试 ")])):d(r).hasTrades?(l(),i("div",Z,[e("div",tt,[e("div",et,[t[9]||(t[9]=e("h3",{class:"text-sm font-medium text-gray-500"},"总持仓股票数",-1)),e("p",st,a(Object.keys(d(r).trades).length),1)]),e("div",ot,[t[10]||(t[10]=e("h3",{class:"text-sm font-medium text-gray-500"},"总投入成本",-1)),e("p",at,"$"+a(_.value.toFixed(2)),1)]),e("div",rt,[t[11]||(t[11]=e("h3",{class:"text-sm font-medium text-gray-500"},"当前总市值",-1)),e("p",{class:x(["text-2xl font-bold mt-2",b.value>=_.value?"text-success":"text-danger"])}," $"+a(b.value.toFixed(2)),3)])]),e("div",nt,[(l(!0),i(N,null,O(h.value,s=>{var c;return l(),i("div",{key:s.code,class:"card hover:shadow-lg transition-shadow cursor-pointer",onClick:m=>o.$router.push(`/detail/${s.code}`)},[e("div",it,[e("div",null,[e("h3",dt,a(s.code),1),e("p",ct,a(s.totalShares)+" 股",1)]),e("div",ut,[e("p",mt,"$"+a(((c=s.currentPrice)==null?void 0:c.toFixed(2))||"--"),1),s.quote?(l(),i("p",{key:0,class:x(["text-sm",s.quote.change>=0?"text-success":"text-danger"])},a(s.quote.change>=0?"+":"")+a(s.quote.change.toFixed(2))+" ("+a(s.quote.changePercent)+") ",3)):Q("",!0),e("button",{onClick:B(m=>F(s.code),["stop"]),class:"mt-2 text-xs px-2 py-1 rounded bg-red-50 text-red-600 hover:bg-red-100",title:"删除该股票"},"删除",8,xt)])]),e("div",pt,[e("div",ft,[t[12]||(t[12]=e("span",{class:"text-gray-600"},"平均成本:",-1)),e("span",gt,"$"+a(s.avgCost.toFixed(2)),1)]),e("div",vt,[t[13]||(t[13]=e("span",{class:"text-gray-600"},"总市值:",-1)),e("span",yt,"$"+a(s.marketValue!=null?s.marketValue.toFixed(2):"--"),1)]),e("div",ht,[t[14]||(t[14]=e("span",{class:"text-gray-600"},"盈亏:",-1)),e("span",{class:x(["font-medium",(s.totalProfitLoss??0)>=0?"text-success":"text-danger"])},a((s.totalProfitLoss??0)>=0?"+":"")+a(s.profitLossPercent!=null?s.profitLossPercent.toFixed(2):"--")+"% ",3)])]),e("div",_t,[e("div",{class:x(["text-sm font-medium",s.totalProfitLoss>=0?"text-success":"text-danger"])}," 总盈亏: $"+a(s.totalProfitLoss.toFixed(2)),3)])],8,lt)}),128))])])):(l(),i("div",Y,[t[8]||(t[8]=e("div",{class:"text-gray-600 mb-4"},"还没有任何交易记录",-1)),P(n,{to:"/add-trade",class:"btn-primary"},{default:$(()=>[...t[7]||(t[7]=[v(" 添加第一笔交易 ",-1)])]),_:1})]))])}}};export{Pt as default};
