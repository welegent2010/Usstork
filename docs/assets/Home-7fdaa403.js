import{u as T,b as C,l as V,k as g,m as q,n as L,c as S,o as n,d as l,e as s,h as F,i as j,f as k,v as I,j as v,p as i,t as o,q as x,F as K,s as N,g as O}from"./index-cee74b2b.js";import{u as Q}from"./trades-15f404fc.js";import{g as B,s as D,a as M}from"./stockApi-1ea7b332.js";const U={class:"space-y-6"},z={class:"flex justify-between items-center"},E={class:"card"},H={class:"flex gap-2"},W={key:0,class:"text-center py-8"},G={key:1,class:"card text-center"},J={class:"text-danger"},R={key:2,class:"card text-center"},X={key:3,class:"space-y-6"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Z={class:"card"},tt={class:"text-2xl font-bold text-gray-900 mt-2"},st={class:"card"},et={class:"text-2xl font-bold text-gray-900 mt-2"},ot={class:"card"},at={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},rt=["onClick"],nt={class:"flex justify-between items-start mb-4"},lt={class:"text-lg font-semibold text-gray-900"},dt={class:"text-sm text-gray-600"},it={class:"text-right"},ct={class:"text-lg font-semibold"},ut={class:"space-y-2"},mt={class:"flex justify-between text-sm"},xt={class:"font-medium"},pt={class:"flex justify-between text-sm"},ft={class:"font-medium"},gt={class:"flex justify-between text-sm"},vt={class:"mt-4 pt-4 border-t border-gray-200"},wt={__name:"Home",setup(yt){const r=Q(),A=T(),u=C(""),y=C({});V(()=>{u.value=B()||"",A.isAuthenticated&&r.fetchTrades()});const P=()=>{D(u.value),p()},p=async()=>{if(r.hasTrades)for(const a of Object.keys(r.trades))try{const t=await M(a);t.success&&(y.value[a]=t)}catch(t){console.error(`Failed to fetch quote for ${a}:`,t)}},h=g(()=>Object.entries(r.trades).map(([a,t])=>{const d=y.value[a],e=(d==null?void 0:d.price)||0,c=e*t.totalShares,m=t.totalCost,w=c-m,$=m>0?w/m*100:0;return{...t,code:a,currentPrice:e,marketValue:c,totalProfitLoss:w,profitLossPercent:$,quote:d}})),_=g(()=>Object.values(r.trades).reduce((a,t)=>a+t.totalCost,0)),b=g(()=>h.value.reduce((a,t)=>a+t.marketValue,0));q(()=>r.hasTrades,a=>{a&&p()});let f;return V(()=>{f=setInterval(p,3e4)}),L(()=>{f&&clearInterval(f)}),(a,t)=>{const d=S("router-link");return n(),l("div",U,[s("div",z,[t[3]||(t[3]=s("h1",{class:"text-2xl font-bold text-gray-900"},"我的持仓",-1)),F(d,{to:"/add-trade",class:"btn-primary"},{default:j(()=>[...t[2]||(t[2]=[v(" 添加交易 ",-1)])]),_:1})]),s("div",E,[t[4]||(t[4]=s("h3",{class:"text-lg font-medium mb-4"},"Alpha Vantage API 密钥",-1)),s("div",H,[k(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),type:"password",placeholder:"输入您的 API 密钥（可选）",class:"form-input flex-1"},null,512),[[I,u.value]]),s("button",{onClick:P,class:"btn-primary"}," 保存 ")]),t[5]||(t[5]=s("p",{class:"text-sm text-gray-600 mt-2"},[v(" 如果没有密钥，系统会使用模拟数据。获取免费密钥： "),s("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",class:"text-primary-600 hover:text-primary-500"}," Alpha Vantage ")],-1))]),i(r).loading?(n(),l("div",W,[...t[6]||(t[6]=[s("div",{class:"text-gray-600"},"加载中...",-1)])])):i(r).error?(n(),l("div",G,[s("div",J,o(i(r).error),1),s("button",{onClick:t[1]||(t[1]=(...e)=>i(r).fetchTrades&&i(r).fetchTrades(...e)),class:"btn-primary mt-4"}," 重试 ")])):i(r).hasTrades?(n(),l("div",X,[s("div",Y,[s("div",Z,[t[9]||(t[9]=s("h3",{class:"text-sm font-medium text-gray-500"},"总持仓股票数",-1)),s("p",tt,o(Object.keys(i(r).trades).length),1)]),s("div",st,[t[10]||(t[10]=s("h3",{class:"text-sm font-medium text-gray-500"},"总投入成本",-1)),s("p",et,"$"+o(_.value.toFixed(2)),1)]),s("div",ot,[t[11]||(t[11]=s("h3",{class:"text-sm font-medium text-gray-500"},"当前总市值",-1)),s("p",{class:x(["text-2xl font-bold mt-2",b.value>=_.value?"text-success":"text-danger"])}," $"+o(b.value.toFixed(2)),3)])]),s("div",at,[(n(!0),l(K,null,N(h.value,e=>{var c;return n(),l("div",{key:e.code,class:"card hover:shadow-lg transition-shadow cursor-pointer",onClick:m=>a.$router.push(`/detail/${e.code}`)},[s("div",nt,[s("div",null,[s("h3",lt,o(e.code),1),s("p",dt,o(e.totalShares)+" 股",1)]),s("div",it,[s("p",ct,"$"+o(((c=e.currentPrice)==null?void 0:c.toFixed(2))||"--"),1),e.quote?(n(),l("p",{key:0,class:x(["text-sm",e.quote.change>=0?"text-success":"text-danger"])},o(e.quote.change>=0?"+":"")+o(e.quote.change.toFixed(2))+" ("+o(e.quote.changePercent)+") ",3)):O("",!0)])]),s("div",ut,[s("div",mt,[t[12]||(t[12]=s("span",{class:"text-gray-600"},"平均成本:",-1)),s("span",xt,"$"+o(e.avgCost.toFixed(2)),1)]),s("div",pt,[t[13]||(t[13]=s("span",{class:"text-gray-600"},"总市值:",-1)),s("span",ft,"$"+o(e.marketValue.toFixed(2)),1)]),s("div",gt,[t[14]||(t[14]=s("span",{class:"text-gray-600"},"盈亏:",-1)),s("span",{class:x(["font-medium",e.profitLoss>=0?"text-success":"text-danger"])},o(e.profitLoss>=0?"+":"")+o(e.profitLossPercent.toFixed(2))+"% ",3)])]),s("div",vt,[s("div",{class:x(["text-sm font-medium",e.totalProfitLoss>=0?"text-success":"text-danger"])}," 总盈亏: $"+o(e.totalProfitLoss.toFixed(2)),3)])],8,rt)}),128))])])):(n(),l("div",R,[t[8]||(t[8]=s("div",{class:"text-gray-600 mb-4"},"还没有任何交易记录",-1)),F(d,{to:"/add-trade",class:"btn-primary"},{default:j(()=>[...t[7]||(t[7]=[v(" 添加第一笔交易 ",-1)])]),_:1})]))])}}};export{wt as default};
